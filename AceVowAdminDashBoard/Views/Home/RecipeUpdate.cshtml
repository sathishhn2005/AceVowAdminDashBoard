@{
    List<SelectListItem> Users = ViewBag.lstUsers;
   
}
@{
    ViewBag.Title = "RecipeUpdate";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="page-content">
    <!-- Page title -->
    <div class="page-title">
        <div class="row justify-content-between align-items-center">
            <div class="col-md-6 d-flex align-items-center justify-content-between justify-content-md-start mb-3 mb-md-0">
                <!-- Page title + Go Back button -->
                <div class="d-inline-block">
                    <h5 class="h4 d-inline-block font-weight-400 mb-0 text-white">Recipe Update</h5>
                </div>
                <!-- Additional info -->
                <div class="align-items-center ml-4 d-inline-flex">
                    <span class="h4 text-info mb-0 mr-2">9</span>
                    <span class="text-sm opacity-7 text-white">New products</span>
                </div>
                <!-- Optional link -->
                <a href="card-listing.html" class="text-sm text-info d-none d-lg-inline-block ml-4">
                    See
                    cards
                </a>
            </div>
            <div class="col-md-6 d-flex align-items-center justify-content-between justify-content-md-end">
                <div class="actions actions-dark d-inline-block">
                    <a href="#" class="action-item ml-md-4">
                        <i class="far fa-file-export mr-2"></i>Export
                    </a>
                    <a href="#" class="action-item ml-3">
                        <i class="far fa-cog mr-2"></i>Settings
                    </a>
                </div>
                <a href="#" class="btn btn-sm btn-white btn-icon-only rounded-circle ml-4">
                    <span class="btn-inner--icon"><i class="far fa-plus"></i></span>
                </a>
            </div>
        </div>
    </div>
    <!-- Listing -->
    <div class="card">
        <!-- Card header -->
        <div class="card-header actions-toolbar border-0">
            <div class="actions-search" id="actions-search">
                <div class="input-group input-group-merge input-group-flush">
                    <div class="input-group-prepend">
                        <span class="input-group-text bg-transparent"><i class="far fa-search"></i></span>
                    </div>
                    <input type="text" class="form-control form-control-flush"
                           placeholder="Type and hit enter ...">
                    <div class="input-group-append">
                        <a href="#" class="input-group-text bg-transparent" data-action="search-close"
                           data-target="#actions-search"><i class="far fa-times"></i></a>
                    </div>
                </div>
            </div>
            <div class="row justify-content-between align-items-center">
                <div class="col">
                    <h6 class="d-inline-block mb-0">Update Recipe</h6>
                </div>
                <div class="col text-right">
                    <div class="actions">
                        <a href="#" class="action-item mr-3" data-action="search-open"
                           data-target="#actions-search"><i class="far fa-search"></i></a>
                        <div class="dropdown mr-3">
                            <a href="#" class="action-item" role="button" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-filter"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="#">
                                    <i class="far fa-sort-amount-down"></i>Newest
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="far fa-sort-alpha-down"></i>From A-Z
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="far fa-sort-alpha-up"></i>From Z-A
                                </a>
                            </div>
                        </div>
                        <div class="dropdown" data-toggle="dropdown">
                            <a href="#" class="action-item" role="button" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-ellipsis-h"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a href="#" class="dropdown-item">Refresh</a>
                                <a href="#" class="dropdown-item">Manage Widgets</a>
                                <a href="#" class="dropdown-item">Settings</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group my-4">
            <div class="row">
                <div class="col-lg-4 offset-lg-4">
                    @Html.DropDownList("ddlUserList", new SelectList(Users, "Value", "Text"), "--Select Users--", new { @class = "form-control" })
                </div>
            </div>
        </div>
        <!-- Table -->
        <div class="table-responsive">
            <table id="tblRecipe" class="table align-items-center">
                <thead>
                    <tr>

                        <th>Recipe Name</th>
                        <th>Recipe Category</th>
                        <th>Ingredients</th>

                        <th>Action</th>
                        <th>Active/Deactive</th>
                    </tr>
                </thead>
                <tbody class="list">
                </tbody>
            </table>
        </div>
    </div>
    <!-- Load more -->
    <div class="mt-4 text-center">
        <a href="#" class="btn btn-sm btn-neutral rounded-pill shadow hover-translate-y-n3">
            Load more
            ...
        </a>
    </div>
</div>
<div class="box d-none">
    <!-- /.box-header -->
    <h1 class="text-center text-success">@TempData["Alertmsg"]</h1>
    <input type="hidden" id="hdnId" name="hdnId" value="0" />
    <div class="box-body">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#home8" role="tab"><span><i class="mdi mdi-hotel mr-10"></i>Recipe View</span></a> </li>

        </ul>
        <div class="form-group my-4">
            <div class="row">
                <div class="col-lg-4 offset-lg-4">
                    @Html.DropDownList("ddlUserList", new SelectList(Users, "Value", "Text"), "--Select Users--", new { @class = "form-control" })
                </div>
            </div>
        </div>

        <div class="tab-content tabcontent-border">
            <div class="tab-pane active" id="home8" role="tabpanel">
                <div class="tab-pane table-responsive active" id="All">
                    <table id="tblRecipe" class="table m-b-0 table-hover">
                        <thead class="text-center">
                            <tr>

                                <th>Recipe Name</th>
                                <th>Recipe Category</th>
                                <th>Ingredients</th>

                                <th>Action</th>
                                <th>Active/Deactive</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function clearComments(key) {
        $('input[name=txtIngridients]').each(function (i, item) {
            var comments = $(item).val();

            if (i == key) {
                $('#hdnId').val(comments);
            }
        });
    }
    function UpdateRecipe(id) {
        var replyComment = $('#hdnId').val();
        //alert(comments, replyComment);
        var param = {
            RecipeId: id,
            Ingredients: replyComment
        };

        $.ajax({
            type: "POST",
            url: "/Home/UpdateRecipe",
            dataType: "json",
            contentType: 'application/json',
            data: JSON.stringify(param),
            success: function (res) {
                alert(res);
                $('#hdnId').val('');
                GetRecipe();
            },
            error: function () {
                // $("#lblMessage").html('Error while Registring the Company!.');

            }
        })

    }
    $(document).ready(function () {
        GetRecipe();
        // window.location.href = "/Home/EditClient";
    });
    $('#ddlUserList').change(function () {
        GetRecipe();
    });
    function GetRecipe() {
        var param = { UserId: $('#ddlUserList').val() };
        $("#tblRecipe").find("tr:not(:first)").remove();

        $.ajax({

            type: "GET",
            url: "GetRecipe",
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: param,
            success: function (Result) {
                if (Result.length > 0) {
                    var i = 0;
                    $.each(Result, function (key, value) {
                        i++;
                        var hdnID = "hdnobjJSonVal_" + i;
                        var hdnToggleId = "hdnobjJSonVal_" + value.RecipeId;
                        var hdId = i;
                        var JVal = JSON.stringify(value);
                        $('#tblRecipe').append('<tr> <td>' + value.RecipeName + '</td><td>' + value.RecipeCategory + '</td><td class="text-center"><input class="form-control" type="text" name="txtIngridients" id="txtIngridients" onblur="clearComments(' + "'" + key + "'" + ')" value=' + "'" + value.Ingredients + "'" + '></td><td><button class="btn btn-primary-secondary" type="button" onclick=UpdateRecipe("' + value.RecipeId + '")><i class="fas fa-reply"></i></button></td><td><div class="checkbox switcher"><label for=' + hdnToggleId + ' class="mb-0"><input onchange="Deactivate(' + value.RecipeId + ',' + value.IsActive + ')" type="checkbox" id=' + hdnToggleId + ' value=' + value.UserId + '><span><small></small></span></label></div><input type="hidden" id=' + hdnID + ' value=' + "'" + JVal + "'" + '></td></tr>');
                        if (value.IsActive == 0) {
                            $("#" + hdnToggleId).prop('checked', false);
                        }
                        else {
                            $("#" + hdnToggleId).prop('checked', true);
                        }
                    });
                }
                else {
                    $('#tblRecipe').append('<tr> <td colspan="14" aligen="center" > No Records found </td></tr>');
                }

            },
            error: function () {

            }
        })
    }
    function Deactivate(id, isactive) {
        var hdnID = "hdnobjJSonVal_" + id;
        var isactive;
        if ($('input:checkbox[id=' + hdnID + ']').is(':checked') == true) {
            isactive = true;
        }
        else { isactive = false; };
        var Rid = '' + id;
        var objUser = { RecipeId: Rid, IsActive: isactive };
        $.ajax({
            type: "POST",
            url: "DeactivateRecipe",
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: objUser,
            success: function (Result) {
                alert(Result);
                GetRecipe();
            },
            error: function () {
                alert('Error while activate/deactivate recipe!.');
            }
        })
    }
</script>